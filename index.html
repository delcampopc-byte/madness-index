<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The Madness Index - NCAA Tournament Bracket Predictor (v3.2)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Core styles -->
  <link rel="stylesheet" href="styles.css?v=20" />
</head>
<body>
  <div class="app-shell">
    <!-- ================= HEADER ================= -->
    <header class="app-header enhanced-header">
  <div class="hero-logo-wrap">
    <img src="madness-index-main-logo.PNG" alt="Madness Index Logo" class="hero-logo" />
  </div>
  <div class="hero-text-wrap">
  <div class="hero-overline">NCAA TOURNAMENT MATCHUP ENGINE</div>

  <h1 class="hero-title">
    <span class="hero-title-bracket hero-title-bracket-left">[</span>
    THE <span class="hero-title-accent">MADNESS</span> INDEX
    <span class="hero-title-bracket hero-title-bracket-right">]</span>
  </h1>

  <p class="hero-subtitle">
    Head-to-head NCAA Tournament matchup engine
    <span class="hero-sub-highlight">powered by advanced analytics.</span>
  </p>

  <div class="version-badge">v3.2</div>
</div>
</header>
  
 <section id="matchupBar" class="card matchup-bar">
  <div class="matchup-bar-main">
    <div class="matchup-bar-left">
      <span class="matchup-bar-label">Cinderella</span>
      <div class="matchup-bar-team">
        <span id="matchupCinderName">Team A</span>
        <span id="matchupCinderSeed" class="matchup-bar-seed"></span>
      </div>
    </div>

    <div class="matchup-bar-center">
      <div class="matchup-bar-vs">vs</div>
      <span id="matchupRoundPill" class="summary-round-pill matchup-bar-round">
        Round of 64
      </span>
      <button id="editMatchupBtn" class="matchup-bar-edit">
        Edit matchup ▾
      </button>
    </div>

    <div class="matchup-bar-right">
      <span class="matchup-bar-label">Favorite</span>
      <div class="matchup-bar-team">
        <span id="matchupFavoriteName">Team B</span>
        <span id="matchupFavoriteSeed" class="matchup-bar-seed"></span>
      </div>
    </div>
  </div>
</section>

        <!-- ================ TOP CONTROLS ================ -->
    <section class="top-bar">
      <!-- CSV & Template -->
      <div class="card controls-card">
        <h2 class="card-title" data-copy="controls.data_title">1. Load Tournament Data</h2>
        <div class="control-row">
          <label for="csvFile" class="file-label">
            <span data-copy="controls.csv_label">Upload CSV (64-team field or custom subset)</span>
            <input type="file" id="csvFile" accept=".csv" />
          </label>
          <button id="downloadTemplateBtn" class="btn ghost">
            <span data-copy="controls.template_btn">Download CSV Template</span>
          </button>
        </div>
        <p class="helper-text" data-copy="controls.csv_help">
          CSV must match the Madness Index field spec (Team, Seed, OffEff, DefEff, AdjEM, eFG, 3P%, 3P Rate, FTR, TO%, ORB%, DRB%, NB2, DEFG, Opp TO/poss,
          Steals/poss, Tempo, SOS, EPR, %FT points, %Pts from 2, %Pts from 3). Percent-like values (e.g. 58.5) are auto-normalized to decimals.
        </p>
        <div id="status" class="status"></div>
      </div>

      <!-- Team & Role Selection -->
      <div class="card controls-card">
        <h2 class="card-title" data-copy="controls.matchup_title">2. Select Matchup</h2>

        <div class="control-row">
          <div class="select-wrap">
            <label for="teamA">
              <span data-copy="controls.teamA_label">Team A</span>
            </label>
            <select id="teamA">
              <option value="" disabled selected>Select Team A</option>
            </select>
          </div>

          <div class="select-wrap">
            <label for="teamB">
              <span data-copy="controls.teamB_label">Team B</span>
            </label>
            <select id="teamB">
              <option value="" disabled selected>Select Team B</option>
            </select>
          </div>
        </div>

        <div class="role-mode">
          <div class="role-label">
            <strong data-copy="controls.role_mode_label">Role Mode</strong>
            <span class="pill pill-soft" data-copy="controls.role_mode_hint">
              Auto uses Seed to assign Favorite vs Cinderella.
            </span>
          </div>
          <div class="role-options">
            <label>
              <input type="radio" name="roleMode" value="auto" checked />
              <span data-copy="controls.role_auto">Auto (by seed)</span>
            </label>
            <label>
              <input type="radio" name="roleMode" value="A_fav" />
              <span data-copy="controls.role_Afav">Force Team A Favorite</span>
            </label>
            <label>
              <input type="radio" name="roleMode" value="B_fav" />
              <span data-copy="controls.role_Bfav">Force Team B Favorite</span>
            </label>
          </div>
        </div>

        <div class="control-actions">
          <button id="compareBtn" class="btn primary">
            <span data-copy="controls.compare_btn">Compare Matchup</span>
          </button>

          <div class="round-selector-wrap">
            <button id="roundSelectBtn" class="btn ghost">
              Select Round
            </button>

            <div id="roundDropdown" class="round-dropdown hidden">
              <div class="round-option" data-round="R64">Round of 64</div>
              <div class="round-option" data-round="R32">Round of 32</div>
              <div class="round-option" data-round="S16">Sweet Sixteen</div>
              <div class="round-option" data-round="E8">Elite Eight</div>
              <div class="round-option" data-round="F4">Final Four</div>
              <div class="round-option" data-round="Champ">Championship</div>
            </div>
          </div>

  <!-- Sandbox Mode toggle -->
  <label class="sandbox-toggle">
    <input type="checkbox" id="sandboxModeToggle" />
    <span>Sandbox mode (ignore round constraints)</span>
  </label>

          <button id="swapBtn" class="btn secondary">
            <span data-copy="controls.swap_btn">Swap Teams</span>
          </button>

          <button id="toggleDebugBtn" class="btn subtle">
            <span data-copy="controls.debug_btn">Toggle Debug View</span>
          </button>
        </div>
      </div> <!-- end .card.controls-card (Select Matchup) -->
    </section> <!-- end .top-bar -->
<!-- ================ CORE TRAITS & TEAM SCORECARDS ================ -->
<main id="result" class="result-layout">

  <!-- ============================================================= -->
  <!-- ===================== CINDERELLA CARD ======================= -->
  <!-- ============================================================= -->
  <section id="cindCard" class="team-card card">
    <div class="flip-inner">

      <!-- ===================== FRONT FACE ====================== -->
      <div class="card-face card-front">

        <!-- Header -->
        <header class="team-card-header">
          <div class="team-label-wrap">
            <span class="role-tag cind-tag" data-copy="card.cinderella_label">Cinderella</span>
            <h2 id="teamATitle">Team A</h2>
          </div>
          <div class="seed-label"><span id="teamASeed"></span></div>
        </header>

        <!-- Core Traits Mini Flip Tile -->
        <section class="profile-section flip-tile">
          <div class="flip-tile-inner">

            <!-- Tile FRONT -->
            <div class="tile-face tile-front">
              <div class="section-header">
                <h3 data-copy="card.cind_profile_title">Cinderella Profile (Core Traits)</h3>
                <button
                  id="explainCindA"
                  class="link-btn explain-toggle"
                  data-target="#cindProfileExplainA"
                  data-copy="card.explain_btn"
                >Explain</button>
              </div>

              <table id="cindProfileTableA" class="explain-table"></table>
              <div id="cindProfileExplainA" class="explain-panel"></div>

              <div class="subtotal-row">
                <span data-copy="card.profile_subtotal">Profile Subtotal (incl. Breadth)</span>
                <span id="cindSubtotalA" class="subtotal-value">0.00</span>
              </div>
            </div>

            <!-- Tile BACK -->
            <div class="tile-face tile-back">
              <h4>Core Traits Explained</h4>
              <p id="backCoreTileA" class="back-line"></p>
              <p id="backBreadthTileA" class="back-line"></p>
              <p class="back-helper">Tap again to return to the full Core Traits table.</p>
            </div>

          </div>
        </section>

        <!-- Identity Tile -->
        <div id="identityTileA" class="context-tile context-neutral flip-tile identity-tile">
          <div class="flip-tile-inner">

            <!-- FRONT -->
            <div class="tile-face tile-front">
              <div class="context-header">
                <span class="context-label">Tournament Identity</span>
                <span id="identityScoreA" class="context-score">—</span>
              </div>
              <div class="context-subrow identity-subrow">
                <span id="identityRoleA" class="context-tier">Neutral</span>
                <span id="identityDetailA" class="context-desc">CIS 0 • FAS 0</span>
              </div>
            </div>

            <!-- BACK -->
            <div class="tile-face tile-back">
              <h4>Identity Explained</h4>
              <p id="backIdentityA" class="back-line"></p>
              <p class="back-helper">Tap again to see the identity tile.</p>
            </div>

          </div>
        </div>

        <!-- Bottom Tiles -->
        <div class="team-card-bottom">

          <!-- Résumé Tile -->
          <div id="resumeTileA" class="context-tile context-neutral flip-tile">
            <div class="flip-tile-inner">

              <div class="tile-face tile-front">
                <div class="context-header">
                  <span class="context-label">Résumé Context</span>
                  <span id="resumeAdjA" class="context-score">0.000</span>
                </div>
                <div class="context-subrow">
                  <span id="resumeTierA" class="context-tier">Average</span>
                  <span class="context-desc">Record vs schedule strength</span>
                </div>
              </div>

              <div class="tile-face tile-back">
                <h4>Résumé Context Explained</h4>
                <p id="backResumeTileA" class="back-line"></p>
                <p class="back-helper">Tap again to see the résumé tile.</p>
              </div>

            </div>
          </div>

          <!-- Profile Marks -->
          <div id="marksTileA" class="context-tile context-neutral inline-marks-tile flip-tile">
            <div class="flip-tile-inner">

              <div class="tile-face tile-front">
                <div class="context-header">
                  <span class="context-label">Profile Marks</span>
                  <span class="context-score">&nbsp;</span>
                </div>
                <div class="context-subrow">
                  <div id="inlineMarksA" class="inline-marks-strip"></div>
                </div>
              </div>

              <div class="tile-face tile-back">
                <h4>Profile Marks Explained</h4>
                <p id="backMarksTileA" class="back-line"></p>
                <p class="back-helper">Tap again to see the badges.</p>
              </div>

            </div>
          </div>

        </div>

        <!-- Team Total -->
        <footer class="team-total-row">
          <span data-copy="card.team_total">Baseline Madness Index</span>
          <span id="teamTotalA" class="team-total-value">0.00</span>
        </footer>

      </div><!-- END FRONT FACE -->


      <!-- ===================== BACK FACE ====================== -->
      <div class="card-face card-back">
        <div class="card-back-content">
          <h3>How This Scorecard Works</h3>

          <p id="backFormulaA" class="back-line"></p>
          <p id="backCoreA" class="back-line"></p>
          <p id="backBreadthA" class="back-line"></p>
          <p id="backResumeA" class="back-line"></p>
          <p id="backMarksA" class="back-line"></p>

          <p class="back-helper">Click this card again to flip back to the full stat view.</p>
        </div>
      </div>

    </div><!-- END flip-inner -->
  </section>



  <!-- ============================================================= -->
  <!-- ======================= FAVORITE CARD ======================= -->
  <!-- ============================================================= -->
  <section id="favCard" class="team-card card">
    <div class="flip-inner">

      <!-- ===================== FRONT FACE ====================== -->
      <div class="card-face card-front">

        <!-- Header -->
        <header class="team-card-header">
          <div class="team-label-wrap">
            <span class="role-tag fav-tag" data-copy="card.favorite_label">Favorite</span>
            <h2 id="teamBTitle">Team B</h2>
          </div>
          <div class="seed-label"><span id="teamBSeed"></span></div>
        </header>

     <!-- Favorite Profile (Core Traits + Breadth) — MINI FLIP TILE -->
<section class="profile-section flip-tile">
  <div class="flip-tile-inner">

    <!-- FRONT: existing Favorite Core Traits table -->
    <div class="tile-face tile-front">
      <div class="section-header">
        <h3 data-copy="card.fav_profile_title">Favorite Profile (Core Traits)</h3>
        <button
          id="explainFavB"
          class="link-btn explain-toggle"
          data-target="#favProfileExplainB"
          data-copy="card.explain_btn"
        >
          Explain
        </button>
      </div>

      <table id="favProfileTableB" class="explain-table"></table>
      <div id="favProfileExplainB" class="explain-panel"></div>

      <div class="subtotal-row">
        <span data-copy="card.profile_subtotal">Profile Subtotal (incl. Breadth)</span>
        <span id="favSubtotalB" class="subtotal-value">0.00</span>
      </div>
    </div>

    <!-- BACK: explanation for Favorite Core Traits only -->
    <div class="tile-face tile-back">
      <h4>Core Traits Explained</h4>
      <p id="backCoreB" class="back-line"></p>
      <p id="backBreadthB" class="back-line"></p>
      <p class="back-helper">
        Tap again to return to the full Core Traits table.
      </p>
    </div>

  </div>
</section>

        <!-- Identity Tile -->
        <div id="identityTileB" class="context-tile context-neutral flip-tile identity-tile">
          <div class="flip-tile-inner">

            <div class="tile-face tile-front">
              <div class="context-header">
                <span class="context-label">Tournament Identity</span>
                <span id="identityScoreB" class="context-score">—</span>
              </div>
              <div class="context-subrow identity-subrow">
                <span id="identityRoleB" class="context-tier">Neutral</span>
                <span id="identityDetailB" class="context-desc">CIS 0 • FAS 0</span>
              </div>
            </div>

            <div class="tile-face tile-back">
              <h4>Identity Explained</h4>
              <p id="backIdentityB" class="back-line"></p>
              <p class="back-helper">Tap again to see the identity tile.</p>
            </div>

          </div>
        </div>

        <!-- Bottom Tiles -->
        <div class="team-card-bottom">

          <!-- Résumé -->
          <div id="resumeTileB" class="context-tile context-neutral flip-tile">
            <div class="flip-tile-inner">

              <div class="tile-face tile-front">
                <div class="context-header">
                  <span class="context-label">Résumé Context</span>
                  <span id="resumeAdjB" class="context-score">0.000</span>
                </div>
                <div class="context-subrow">
                  <span id="resumeTierB" class="context-tier">Average</span>
                  <span class="context-desc">Record vs schedule strength</span>
                </div>
              </div>

              <div class="tile-face tile-back">
                <h4>Résumé Context Explained</h4>
                <p id="backResumeTileB" class="back-line"></p>
                <p class="back-helper">Tap again to see the résumé tile.</p>
              </div>

            </div>
          </div>

          <!-- Profile Marks -->
          <div id="marksTileB" class="context-tile context-neutral inline-marks-tile flip-tile">
            <div class="flip-tile-inner">

              <div class="tile-face tile-front">
                <div class="context-header">
                  <span class="context-label">Profile Marks</span>
                  <span class="context-score">&nbsp;</span>
                </div>
                <div class="context-subrow">
                  <div id="inlineMarksB" class="inline-marks-strip"></div>
                </div>
              </div>

              <div class="tile-face tile-back">
                <h4>Profile Marks Explained</h4>
                <p id="backMarksTileB" class="back-line"></p>
                <p class="back-helper">Tap again to see the badges.</p>
              </div>

            </div>
          </div>

        </div>

        <!-- Team Total -->
        <footer class="team-total-row">
          <span data-copy="card.team_total">Baseline Madness Index</span>
          <span id="teamTotalB" class="team-total-value">0.00</span>
        </footer>

      </div><!-- END FRONT -->


      <!-- ===================== BACK FACE ====================== -->
      <div class="card-face card-back">
        <div class="card-back-content">
          <h3>How This Scorecard Works</h3>

          <p id="backFormulaB" class="back-line"></p>
          <p id="backCoreB" class="back-line"></p>
          <p id="backBreadthB" class="back-line"></p>
          <p id="backResumeB" class="back-line"></p>
          <p id="backMarksB" class="back-line"></p>

          <p class="back-helper">Click this card again to flip back to the full stat view.</p>
        </div>
      </div>

    </div><!-- END flip-inner -->
  </section>

</main>

    <!-- ================ INTERACTION METRICS TABLE ================ -->
<section id="interactionsSection" class="card interactions-card">
  <div class="legend-header">
    <h3>4. Interaction Metrics</h3>
  </div>

  <p class="summary-help">
    Matchup-specific leverage from 3PT Tension, FT Pressure, Paint Tension, Turnover Pressure,
    Glass Tension, Résumé Pressure, Physicality, Shot Quality, and Variance Sensitivity.
  </p>

  <div class="interactions-grid">
    <!-- LEFT: TABLE -->
    <div class="interactions-left">
      <table id="interactionsTable" class="interaction-table">
        <thead>
          <tr>
            <th>Interaction</th>
            <th class="col-domain">Domain</th>
            <th>Edge</th>
            <th class="col-intensity">Intensity</th>
            <th id="adjAHeader">Adj to Team A</th>
            <th id="adjBHeader">Adj to Team B</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <!-- TOTAL BAR (big, matchup-edge style) -->
      <div id="interactionTotalsBar" class="interaction-totals-bar"></div>
    </div>

    <!-- RIGHT: EXPLAINER TILE -->
    <div class="interactions-right interactions-explain-tile">
      <h4>How to Read These</h4>
      <ul>
        <li><strong>Edge</strong> shows which team the matchup trait favors.</li>
        <li><strong>Intensity</strong> = how strong that leverage is (Minor / Moderate / Major).</li>
        <li><strong>Adj to Team A/B</strong> is the exact MI leverage applied to each side.</li>
        <li>Totals below roll directly into <strong>MI_matchup</strong>.</li>
      </ul>

      <div class="explain-note">
        Think of this like your “matchup chessboard”: each row is one pressure point.
        The totals tell you who wins that board overall.
      </div>
    </div>
  </div>
</section>

    <section id="summarySection" class="card summary-card">
        <div class="summary-header">
    <h2 data-copy="summary.title">5. Scorecards & Matchup Summary</h2>
    <p class="summary-help" data-copy="summary.help">
      Final Madness Index scores for each team, the MI gap, and the model’s predicted lean.
    </p>
  </div>

  <!-- Clean matchup summary table -->
  <table id="summaryTable" class="explain-table summary-table">
    <thead>
      <tr>
        <th id="summaryTeamAHeader"></th>
        <th class="summary-matchup-header" data-copy="summary.matchup_header">Matchup Edge</th>
        <th id="summaryTeamBHeader"></th>
      </tr>
    </thead>
    <tbody>
      <!-- JS will inject the matchup row here -->
    </tbody>
  </table>
<!-- Round pill -->
  <div class="summary-row summary-round-row">
    <span class="summary-round-label" data-copy="summary.round">Round:</span>
    <span id="currentRoundLabel" class="summary-round-pill">Round of 64</span>
  </div>

  <!-- Seed / bracket compatibility note (filled by JS) -->
  <p id="summarySeedNote" class="summary-seed-note helper-text"></p>
    </section>

    <!-- ================ DEBUG PANEL ================ -->
    <section id="debugPanel" class="card debug-card hidden">
      <h3 data-copy="debug.title">Developer Debug Panel</h3>
      <p class="helper-text" data-copy="debug.help">
        Shows parsed inputs and rule evaluations for QA. Only visible when Debug View is enabled.
      </p>
      <div id="debugContent" class="debug-content">
        <!-- JS: insert parsed team objects, rule hits/misses, etc. -->
      </div>
    </section>

    <!-- ================ GLOSSARY / COPY-DRIVEN CONTENT ================ -->
    <section id="glossarySection" class="card glossary-card">
      <h3 data-copy="glossary.title">Stat & Rule Glossary</h3>
      <p class="helper-text" data-copy="glossary.help">
        Definitions for all metrics and rules used in the Madness Index. Populated dynamically from copy.json.
      </p>
      <div id="glossaryContent">
        <!-- JS: build glossary list from copy.json.rows / copy.json.glossary -->
      </div>
    </section>

    <!-- ================ FOOTER ================ -->
    <footer class="app-footer">
      <span data-copy="footer.note">
        All logic is deterministic and based solely on the uploaded season stats. No external projections, no z-scores, no machine learning.
      </span>
    </footer>
  </div>

  <!-- Core logic -->
  <script src="madness_index.js?v=20"></script>
</body>
</html>